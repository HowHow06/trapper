from typing import List, Optional

from app.models import TimestampModel
from app.models.lookup import Lookup
from sqlmodel import Field, Relationship


class Vulnerability(TimestampModel, table=True):
    id: Optional[int] = Field(default=None, primary_key=True)
    name: str = Field(max_length=100)
    description: str = Field(max_length=1000)
    type_id: int = Field(foreign_key="lookup.id")
    vulnerability_type: Optional[Lookup] = Relationship(sa_relationship_kwargs={
        "primaryjoin": "Lookup.id==Vulnerability.type_id",
    },)
    patch_suggestion: str = Field(max_length=1000)
    severity_level_id: int = Field(foreign_key="lookup.id")
    severity_level: Optional[Lookup] = Relationship(sa_relationship_kwargs={
        "primaryjoin": "Lookup.id==Vulnerability.severity_level_id",
    },)
    results: List['Result'] = Relationship(back_populates="vulnerability")
