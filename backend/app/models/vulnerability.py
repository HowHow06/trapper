from typing import Optional

from app.models import TimestampModel
from app.models.lookup import Lookup
from sqlmodel import Field, Relationship


class Vulnerability(TimestampModel, table=True):
    id: Optional[int] = Field(default=None, primary_key=True)
    name: str = Field(max_length=100)
    description: str = Field(max_length=255)
    type_id: int = Field(foreign_key="lookup.id")
    vulnerability_type: Optional[Lookup] = Relationship(
        back_populates="vulnerabilities")
    patch_suggestion: str = Field(max_length=1000)
    severity_level_id: int = Field(foreign_key="lookup.id")
    severity_level: Optional[Lookup] = Relationship(
        back_populates="vulnerabilities")


Lookup.vulnerabilities = Relationship(back_populates="severity_level")
# the back populates for `vulnerability_type` is not defined here, not important
